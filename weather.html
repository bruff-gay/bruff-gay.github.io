<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <title>7-Day Outlook ‚Äì KCTV Weather</title>
  <style>
    :root{
      --green:#004d26;
      --gold:#ffb703;
      --dark-gold:#cc9300;
    }
    *{margin:0;padding:0;box-sizing:border-box;font-family:Arial,Helvetica,sans-serif;color:#fff;}
    html,body{min-height:100vh;}
    body{
      display:flex;
      align-items:center;
      justify-content:center;
      background:url('https://wallpaperaccess.com/full/1540049.jpg') center/cover no-repeat;
      position:relative;
      transition:transform 1s ease-in-out;
    }
    body.spin{transform:rotate(360deg);}
    body::before{content:'';position:absolute;inset:0;background:rgba(0,0,0,.45);z-index:0;}

    /* --- KCTV Logo with text overlay --- */
    .kctv-logo{
      position:absolute;
      top:20px;
      left:20px;
      width:160px;
      height:160px;
      border-radius:50%;
      overflow:hidden;
      border:4px solid var(--gold);
      z-index:4;
      display:flex;
      align-items:center;
      justify-content:center;
      background:url('https://wallpaperaccess.com/full/1540049.jpg') center/cover;
    }
    .kctv-logo span{
      font-size:32px;
      font-weight:700;
      color:#fff;
      text-shadow:0 0 6px rgba(0,0,0,.8);
    }

    /* --- News-broadcast style SVG elements --- */
    .lower-third{
      position:absolute;
      bottom:0;
      left:0;
      right:0;
      height:120px;
      z-index:0;
    }
    .ticker{
      position:fixed;
      bottom:0;
      left:0;
      right:0;
      height:24px;
      background:#b20710;
      color:#fff;
      font-weight:700;
      font-size:.9rem;
      line-height:24px;
      white-space:nowrap;
      overflow:hidden;
      z-index:10;
    }
    .ticker span{
      display:inline-block;
      padding-left:100%;
      animation:ticker 25s linear infinite;
    }
    @keyframes ticker{
      0%{transform:translateX(0);}
      100%{transform:translateX(-100%);}
    }

    /* --- rest of original styles --- */
    body.invert{--green:#ffb703;--gold:#004d26;}
    body.invert *{color:#000;}
    body.invert .day-label,
    body.invert .card{
      background:linear-gradient(135deg,var(--gold),#cc9300);
      border-color:var(--green);
    }
    body.invert .day-label{color:var(--green);}
    body.invert .corner{fill:var(--green);}
    body.invert .bg-chooser{background:var(--gold);}
    body.invert .bg-chooser button{background:var(--green);color:#fff;}

    .forecast{position:relative;z-index:1;width:100%;max-width:1200px;display:flex;flex-direction:column;align-items:center;padding:20px;}
    .title{font-size:2.4rem;text-shadow:0 2px 4px rgba(0,0,0,.6);margin-bottom:20px;text-align:center;color:var(--gold);}
    .day-labels{display:flex;gap:10px;width:100%;justify-content:center;flex-wrap:nowrap;margin-bottom:20px;}
    .day-label{background:linear-gradient(135deg,var(--green),#00331a);border:2px solid var(--gold);border-radius:12px;flex:1 1 0;min-width:0;max-width:160px;height:50px;line-height:46px;text-align:center;font-size:clamp(.85rem,1.3vw,1.3rem);font-weight:700;color:var(--gold);box-shadow:0 4px 12px rgba(0,0,0,.4);}
    .bars-container{display:flex;gap:10px;width:100%;justify-content:center;align-items:flex-end;}
    .bar{flex:1 1 0;min-width:0;max-width:160px;display:flex;flex-direction:column;align-items:center;height:100%;}
    .high-box{background:var(--gold);color:#000;font-weight:700;font-size:2.5rem;border-radius:8px;padding:8px 14px;margin-bottom:10px;box-shadow:0 2px 6px rgba(0,0,0,.4);}
    .card{background:linear-gradient(135deg,var(--green),#00331a);border:2px solid var(--gold);border-radius:12px;width:100%;max-width:160px;display:flex;flex-direction:column;align-items:center;justify-content:space-between;padding:20px 8px;flex:1;min-height:260px;}
    .card .emoji{font-size:3rem;line-height:1;}
    .card .low{font-size:2.2rem;font-weight:700;color:#fff;}
    .card .desc{font-size:1.2rem;color:#ddd;}

    .bg-chooser{position:fixed;top:10px;right:10px;background:var(--green);border:2px solid var(--gold);border-radius:8px;padding:10px 15px;z-index:3;display:flex;gap:10px;align-items:center;}
    .bg-chooser.hidden{display:none;}
    .bg-chooser input[type=text]{width:220px;padding:5px;border:none;border-radius:3px;color:#000;}
    .bg-chooser button{background:var(--gold);color:#000;border:none;padding:6px 10px;border-radius:3px;cursor:pointer;font-weight:bold;}
    .bg-chooser button:hover{background:var(--dark-gold);}
    .corner{position:fixed;cursor:pointer;width:200px;height:200px;z-index:2;opacity:.18;transition:opacity .3s;fill:var(--gold);}
    .corner:hover{opacity:.4;}
    .corner.top-left{top:0;left:0;}
    .corner.top-right{top:0;right:0;transform:scaleX(-1);}
    .corner.bottom-left{bottom:0;left:0;transform:scaleY(-1);}
    .corner.bottom-right{bottom:0;right:0;transform:scale(-1,-1);}
    .overlay{position:fixed;inset:0;background:rgba(0,0,0,.7);z-index:10;display:none;align-items:center;justify-content:center;}
    .overlay img{max-width:95%;max-height:95%;border:2px solid var(--gold);border-radius:12px;}
    .overlay button{position:absolute;top:15px;right:15px;background:var(--gold);color:#000;border:none;padding:8px 12px;border-radius:4px;cursor:pointer;font-weight:bold;}
  </style>
</head>
<body>
  <!-- KCTV circular logo with text overlay -->
  <div class="kctv-logo">
    <span>KCTV</span>
  </div>

  <!-- Lower-third backdrop -->
  <svg class="lower-third" preserveAspectRatio="none" viewBox="0 0 1440 120">
    <linearGradient id="grad" x1="0" y1="0" x2="0" y2="1">
      <stop offset="0%" stop-color="rgba(0,0,0,.5)"/>
      <stop offset="100%" stop-color="rgba(0,0,0,.8)"/>
    </linearGradient>
    <rect x="0" y="0" width="1440" height="120" fill="url(#grad)"/>
  </svg>

  <!-- Breaking-news ticker -->
  <div class="ticker">
    <span>üå§Ô∏è LOCAL WEATHER ON THE 8s ‚Ä¢ UPDATES EVERY 10 MINUTES ‚Ä¢ WATCH FOR SEVERE WEATHER ALERTS ‚Ä¢ STAY SAFE ‚Ä¢ üå§Ô∏è</span>
  </div>

  <!-- Background chooser -->
  <div id="bgChooser" class="bg-chooser hidden">
    <input type="text" id="bgUrl" placeholder="Image URL (jpg/png/gif)">
    <button onclick="setBackground()">Set</button>
  </div>

  <!-- Corner SVGs (hidden) -->
  <svg class="corner top-left"  onClick="toggleTheme()"   viewBox="0 0 200 200"><path d="M200 0 L0 0 L0 200 C 60 160 160 60 200 0Z"/></svg>
  <svg class="corner top-right" onClick="toggleBgChooser()" viewBox="0 0 200 200"><path d="M200 0 L0 0 L0 200 C 60 160 160 60 200 0Z"/></svg>
  <svg class="corner bottom-left" onClick="openRadar()"  viewBox="0 0 200 200"><path d="M200 0 L0 0 L0 200 C 60 160 160 60 200 0Z"/></svg>
  <svg class="corner bottom-right" onClick="spinPage()"  viewBox="0 0 200 200"><path d="M200 0 L0 0 L0 200 C 60 160 160 60 200 0Z"/></svg>

  <main class="forecast">
    <h1 class="title" id="cityTitle">7-Day Outlook</h1>
    <div class="day-labels" id="dayLabels"></div>
    <div class="bars-container" id="barsContainer"></div>
  </main>

  <div id="overlay" class="overlay" style="display:none;">
    <img id="overlayImage" src="" alt="Radar">
    <button onclick="closeOverlay()">‚úñ Close</button>
  </div>

  <script>
    const API_KEY = '3d9110e79d4ddaede0e6e018bc37e136';
    let city = {};
    const emojiMap = {
      '01d':'‚òÄÔ∏è','01n':'‚òÄÔ∏è',
      '02d':'üå•Ô∏è','02n':'üå•Ô∏è',
      '03d':'‚òÅÔ∏è','03n':'‚òÅÔ∏è',
      '04d':'‚òÅÔ∏è','04n':'‚òÅÔ∏è',
      '09d':'üåßÔ∏è','09n':'üåßÔ∏è',
      '10d':'üå¶Ô∏è','10n':'üå¶Ô∏è',
      '11d':'‚õàÔ∏è','11n':'‚õàÔ∏è',
      '13d':'‚ùÑÔ∏è','13n':'‚ùÑÔ∏è',
      '50d':'üå´Ô∏è','50n':'üå´Ô∏è'
    };

    /* corner helpers */
    function toggleTheme(){
      document.body.classList.toggle('invert');
    }
    function toggleBgChooser(){
      document.getElementById('bgChooser').classList.toggle('hidden');
    }
    function openRadar(){
      document.getElementById('overlayImage').src='https://radar.weather.gov/ridge/standard/NORTHROCKIES_loop.gif';
      document.getElementById('overlay').style.display='flex';
    }
    function spinPage(){
      document.body.classList.add('spin');
      setTimeout(()=>document.body.classList.remove('spin'),1000);
    }
    function closeOverlay(){
      document.getElementById('overlay').style.display='none';
      document.getElementById('overlayImage').src='';
    }
    function setBackground(){
      const url=document.getElementById('bgUrl').value.trim();
      if(!url) return;
      document.body.style.backgroundImage=`url(${url})`;
      localStorage.setItem('bg',url);
      document.getElementById('bgChooser').classList.add('hidden');
    }

    /* forecast population */
    async function getCity(){
      try{
        const geo = await fetch('https://ipapi.co/json/').then(r=>r.json());
        city = {city: geo.city || 'New York', lat: geo.latitude || 34.0522, lon: geo.longitude || -118.2437};
      }catch(e){
        city = {city: 'New York', lat: 34.0522, lon: -118.2437};
      }
    }
    async function getForecast(){
      if(!city.city) await getCity();
      const url = `https://api.openweathermap.org/data/2.5/forecast?q=${city.city}&units=imperial&cnt=56&appid=${API_KEY}`;
      const data = await fetch(url).then(r=>r.json());
      document.getElementById('cityTitle').textContent = `${data.city.name} 7-Day Outlook`;

      const daily = {};
      data.list.forEach(item=>{
        const date = new Date(item.dt*1000);
        const day = date.toLocaleDateString('en-US',{weekday:'short'});
        if(!daily[day]) daily[day] = {temps:[], icon:item.weather[0].icon, desc:item.weather[0].description};
        daily[day].temps.push(item.main.temp);
      });

      const labels = document.getElementById('dayLabels');
      labels.innerHTML='';
      Object.keys(daily).slice(0,7).forEach(day=>{
        const div=document.createElement('div');
        div.className='day-label';
        div.textContent=day;
        labels.appendChild(div);
      });

      const bars = document.getElementById('barsContainer');
      bars.innerHTML='';
      const allTemps = Object.values(daily).flatMap(d=>d.temps);
      const minTemp = Math.min(...allTemps);
      const maxTemp = Math.max(...allTemps);
      const range = maxTemp - minTemp;

      Object.entries(daily).slice(0,7).forEach(([day,d])=>{
        const hi = Math.round(Math.max(...d.temps));
        const lo = Math.round(Math.min(...d.temps));
        const relHeight = range ? (hi - minTemp) / range : .5;
        const height = Math.max(260, 260 + relHeight * 180);

        const bar=document.createElement('div');
        bar.className='bar';
        bar.style.height = height + 'px';
        bar.innerHTML=`
          <div class="high-box">${hi}¬∞</div>
          <div class="card" style="height:${height-100}px">
            <div class="emoji">${emojiMap[d.icon] || '‚ùì'}</div>
            <div class="low">${lo}¬∞</div>
            <div class="desc">${d.desc}</div>
          </div>
        `;
        bars.appendChild(bar);
      });
    }

    (function loadBg(){
      const saved=localStorage.getItem('bg');
      if(saved) document.body.style.backgroundImage=`url(${saved})`;
    })();
    getForecast();
  </script>
</body>
</html>

